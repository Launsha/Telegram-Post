<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Posting ke Telegram - Tema Gelap</title>
    <style>
        :root {
            --bg-color: #121212;
            --card-color: #1e1e1e;
            --text-color: #e0e0e0;
            --accent-color: #0088cc;
            --error-color: #ff5252;
            --success-color: #4caf50;
            --border-color: #333;
        }
        
        body, html {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .card {
            background-color: var(--card-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        h1, h2, h3 {
            color: var(--accent-color);
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        
        textarea, input[type="text"], input[type="url"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            background-color: #2d2d2d;
            color: var(--text-color);
            font-family: inherit;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .buttons-container {
            margin-top: 10px;
        }
        
        .button-row {
            display: flex;
            margin-bottom: 10px;
            gap: 10px;
        }
        
        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        .btn-primary {
            background-color: var(--accent-color);
            color: white;
        }
        
        .btn-danger {
            background-color: var(--error-color);
            color: white;
        }
        
        .btn-secondary {
            background-color: #555;
            color: white;
        }
        
        .preview {
            margin-top: 20px;
            border: 1px dashed var(--border-color);
            padding: 15px;
            border-radius: 4px;
            background-color: rgba(0, 0, 0, 0.2);
        }
        
        .markdown-help {
            font-size: 0.85em;
            margin-top: 5px;
            color: #999;
        }
        
        .file-input {
            margin-bottom: 15px;
        }
        
        .file-preview {
            max-width: 100%;
            max-height: 200px;
            margin-top: 10px;
            display: none;
        }
        
        #notificationArea {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .notification {
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 4px;
            color: white;
            opacity: 0;
            transition: opacity 0.3s;
            max-width: 300px;
        }
        
        .success {
            background-color: var(--success-color);
            opacity: 1;
        }
        
        .error {
            background-color: var(--error-color);
            opacity: 1;
        }
        
        .add-button-row {
            margin-top: 10px;
        }
        
        .tab {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 20px;
        }
        
        .tab-btn {
            padding: 10px 20px;
            cursor: pointer;
            background-color: transparent;
            border: none;
            color: var(--text-color);
            font-weight: bold;
        }
        
        .tab-btn.active {
            color: var(--accent-color);
            border-bottom: 2px solid var(--accent-color);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .help-icon {
            cursor: pointer;
            margin-left: 5px;
            color: var(--accent-color);
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 280px;
            background-color: #333;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85rem;
            font-weight: normal;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Posting ke Telegram</h1>
            <p>Kirim pesan, gambar, dan video ke channel/grup Telegram Anda</p>
        </header>
        
        <div class="card">
            <div class="tab">
                <button class="tab-btn active" data-tab="post">Buat Post</button>
                <button class="tab-btn" data-tab="settings">Pengaturan</button>
                <button class="tab-btn" data-tab="help">Bantuan</button>
            </div>
            
            <div id="post" class="tab-content active">
                <div class="form-group">
                    <label for="messageText">Pesan: <span class="tooltip">ℹ️<span class="tooltiptext">Mendukung format Markdown Telegram. Lihat tab Bantuan untuk info lebih lanjut.</span></span></label>
                    <textarea id="messageText" rows="6" placeholder="Tulis pesan Anda di sini. Mendukung format Markdown Telegram."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="mediaUpload">Unggah Media (Opsional):</label>
                    <input type="file" id="mediaUpload" class="file-input" accept="image/*,video/*">
                    <img id="imagePreview" class="file-preview" alt="Preview">
                    <video id="videoPreview" class="file-preview" controls></video>
                </div>
                
                <div class="form-group">
                    <label>Tombol Inline:</label>
                    <div id="buttonsContainer" class="buttons-container">
                        <!-- Button rows will be added here -->
                    </div>
                    <button id="addButtonRow" class="btn btn-secondary add-button-row">+ Tambah Baris Tombol</button>
                </div>
                
                <div class="form-group">
                    <button id="sendButton" class="btn btn-primary">Kirim ke Telegram</button>
                </div>
            </div>
            
            <div id="settings" class="tab-content">
                <div class="form-group">
                    <label for="botToken">Token Bot API Telegram:</label>
                    <input type="text" id="botToken" placeholder="Masukkan token bot Telegram Anda" value="7624732821:AAG8QfKRchxGqPgSLrUXlA3Kg9OiRCznEh8">
                </div>
                <div class="form-group">
                    <label for="chatId">ID Chat/Grup/Channel (Opsional):</label>
                    <input type="text" id="chatId" placeholder="Contoh: @channelname atau -1001234567890">
                    <p class="markdown-help">Jika dikosongkan, Anda perlu menambahkan bot ke grup/channel Anda.</p>
                </div>
                <div class="form-group">
                    <button id="saveSettings" class="btn btn-primary">Simpan Pengaturan</button>
                </div>
            </div>
            
            <div id="help" class="tab-content">
                <h3>Bantuan Format Markdown Telegram</h3>
                <p>Telegram mendukung format markdown berikut:</p>
                <ul>
                    <li><code>*teks*</code> untuk <strong>tebal</strong></li>
                    <li><code>_teks_</code> untuk <em>miring</em></li>
                    <li><code>__teks__</code> untuk <u>garis bawah</u></li>
                    <li><code>~teks~</code> untuk <del>coret</del></li>
                    <li><code>`kode`</code> untuk <code>kode</code></li>
                    <li><code>```teks```</code> untuk blok kode</li>
                    <li><code>[text](URL)</code> untuk tautan</li>
                </ul>
                
                <h3>Cara Menggunakan</h3>
                <ol>
                    <li>Pastikan token bot sudah benar di tab Pengaturan</li>
                    <li>Tambahkan bot ke grup/channel Telegram Anda dan jadikan admin</li>
                    <li>Tulis pesan dengan format yang diinginkan</li>
                    <li>Unggah gambar atau video jika diperlukan</li>
                    <li>Tambahkan tombol inline jika diinginkan</li>
                    <li>Klik tombol "Kirim ke Telegram"</li>
                </ol>
                
                <h3>Tombol Inline</h3>
                <p>Untuk setiap tombol, Anda perlu menentukan:</p>
                <ul>
                    <li><strong>Teks</strong> - Teks yang ditampilkan pada tombol</li>
                    <li><strong>URL atau Callback</strong> - URL untuk tautan atau data callback untuk aksi</li>
                </ul>
            </div>
        </div>
    </div>
    
    <div id="notificationArea"></div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Tab functionality
            const tabButtons = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const tabId = button.getAttribute('data-tab');
                    
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));
                    
                    button.classList.add('active');
                    document.getElementById(tabId).classList.add('active');
                });
            });
            
            // Load saved settings
            const savedToken = localStorage.getItem('botToken');
            const savedChatId = localStorage.getItem('chatId');
            
            if (savedToken) {
                document.getElementById('botToken').value = savedToken;
            }
            
            if (savedChatId) {
                document.getElementById('chatId').value = savedChatId;
            }
            
            // Save settings button
            document.getElementById('saveSettings').addEventListener('click', function() {
                const token = document.getElementById('botToken').value.trim();
                const chatId = document.getElementById('chatId').value.trim();
                
                localStorage.setItem('botToken', token);
                localStorage.setItem('chatId', chatId);
                
                showNotification('Pengaturan berhasil disimpan', 'success');
            });
            
            // Media upload preview
            const mediaUpload = document.getElementById('mediaUpload');
            const imagePreview = document.getElementById('imagePreview');
            const videoPreview = document.getElementById('videoPreview');
            
            mediaUpload.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const fileType = file.type;
                const reader = new FileReader();
                
                // Reset previews
                imagePreview.style.display = 'none';
                videoPreview.style.display = 'none';
                
                reader.onload = function(event) {
                    if (fileType.startsWith('image')) {
                        imagePreview.src = event.target.result;
                        imagePreview.style.display = 'block';
                    } else if (fileType.startsWith('video')) {
                        videoPreview.src = event.target.result;
                        videoPreview.style.display = 'block';
                    }
                };
                
                reader.readAsDataURL(file);
            });
            
            // Add button row functionality
            document.getElementById('addButtonRow').addEventListener('click', addButtonRow);
            
            function addButtonRow() {
                const buttonsContainer = document.getElementById('buttonsContainer');
                const buttonRow = document.createElement('div');
                buttonRow.className = 'button-row';
                
                buttonRow.innerHTML = `
                    <input type="text" placeholder="Teks tombol" class="button-text">
                    <input type="text" placeholder="URL atau callback data" class="button-url">
                    <button class="btn btn-danger remove-row">×</button>
                `;
                
                buttonsContainer.appendChild(buttonRow);
                
                buttonRow.querySelector('.remove-row').addEventListener('click', function() {
                    buttonRow.remove();
                });
            }
            
            // Send message functionality
            document.getElementById('sendButton').addEventListener('click', sendMessage);
            
            async function sendMessage() {
                try {
                    const token = document.getElementById('botToken').value.trim();
                    const chatId = document.getElementById('chatId').value.trim();
                    const text = document.getElementById('messageText').value.trim();
                    const mediaFile = document.getElementById('mediaUpload').files[0];
                    
                    if (!token) {
                        throw new Error('Token bot tidak boleh kosong');
                    }
                    
                    if (!text && !mediaFile) {
                        throw new Error('Mohon isi pesan atau unggah media');
                    }
                    
                    if (!chatId) {
                        showNotification('ID Chat/Grup/Channel kosong. Pastikan bot sudah ditambahkan ke grup/channel Anda.', 'error');
                    }
                    
                    // Collect inline keyboard buttons
                    const inlineKeyboard = [];
                    const buttonRows = document.querySelectorAll('.button-row');
                    
                    buttonRows.forEach(row => {
                        const buttonText = row.querySelector('.button-text').value.trim();
                        const buttonUrl = row.querySelector('.button-url').value.trim();
                        
                        if (buttonText && buttonUrl) {
                            const button = buttonUrl.startsWith('http') || buttonUrl.startsWith('https') 
                                ? { text: buttonText, url: buttonUrl }
                                : { text: buttonText, callback_data: buttonUrl };
                            
                            // Check if we need to start a new row
                            if (inlineKeyboard.length === 0 || inlineKeyboard[inlineKeyboard.length - 1].length >= 3) {
                                inlineKeyboard.push([button]);
                            } else {
                                inlineKeyboard[inlineKeyboard.length - 1].push(button);
                            }
                        }
                    });
                    
                    const replyMarkup = inlineKeyboard.length > 0 
                        ? { inline_keyboard: inlineKeyboard } 
                        : undefined;
                    
                    // Prepare request based on media type
                    let apiMethod = 'sendMessage';
                    let formData = new FormData();
                    
                    if (chatId) {
                        formData.append('chat_id', chatId);
                    } else {
                        // If no chatId, we'll use some dummy value and later show a more descriptive error
                        // to guide users to add the bot to their group/channel
                        formData.append('chat_id', '@YourChannel');
                    }
                    
                    if (mediaFile) {
                        if (mediaFile.type.startsWith('image')) {
                            apiMethod = 'sendPhoto';
                            formData.append('photo', mediaFile);
                            if (text) formData.append('caption', text);
                        } else if (mediaFile.type.startsWith('video')) {
                            apiMethod = 'sendVideo';
                            formData.append('video', mediaFile);
                            if (text) formData.append('caption', text);
                        }
                    } else {
                        formData.append('text', text);
                    }
                    
                    formData.append('parse_mode', 'MarkdownV2');
                    
                    if (replyMarkup) {
                        formData.append('reply_markup', JSON.stringify(replyMarkup));
                    }
                    
                    // Send the request
                    const response = await fetch(`https://api.telegram.org/bot${token}/${apiMethod}`, {
                        method: 'POST',
                        body: formData
                    });
                    
                    const result = await response.json();
                    
                    if (result.ok) {
                        showNotification('Pesan berhasil dikirim ke Telegram!', 'success');
                    } else {
                        if (result.description.includes('chat not found')) {
                            showNotification('Chat/grup/channel tidak ditemukan. Pastikan bot sudah ditambahkan ke grup/channel Anda dan dijadikan admin.', 'error');
                        } else {
                            throw new Error(result.description || 'Gagal mengirim pesan ke Telegram');
                        }
                    }
                } catch (error) {
                    showNotification(error.message, 'error');
                    console.error('Error:', error);
                }
            }
            
            // Notification system
            function showNotification(message, type) {
                const notificationArea = document.getElementById('notificationArea');
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.textContent = message;
                
                notificationArea.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.opacity = '0';
                    setTimeout(() => {
                        notification.remove();
                    }, 300);
                }, 5000);
            }
            
            // Add initial button row for convenience
            addButtonRow();
        });
    </script>
</body>
</html>